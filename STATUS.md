# Status

## Current Objective

Expanding automated validation coverage and finishing remaining data modality migrations.

## Where To Resume

- Branch: `refactor/proto-first-completion`

## Last Verified

- `just check` (passes)
- `just test` (passes)
- `just test-e2e` (passes: IT-090 verified)

## How To Verify (Target)

- `just check`
- `just test-e2e`

## What Changed Last

- **Resolved "Hidden" Fields**: `#[lifelog_type(Data)]` no longer injects implicit `uuid` and `timestamp` fields. These are now explicitly defined in `ScreenFrame`, `BrowserFrame`, and `OcrFrame`.
- **Unified Modality Registry**: `DataModality` is no longer generated by directory scanning. `lifelog_types` now re-exports `lifelog_proto::DataModality`, making the Proto the single source of truth.
- **IT-081 Verified**: ACK Gate implemented and verified. Backend now only ACKs chunks if they are marked as indexed.
- **ChunkIngester Fixed**: Corrected logic to check `is_chunk_indexed` on the start offset.
- **SurrealIngestBackend Improved**: Now uses `CREATE` instead of `UPSERT` to be idempotent without overwriting `indexed` status.
- **Integration Test Scaffolding**: `TestContext` now exposes `db_addr` for direct DB manipulation in tests.

## What's Next

- **Connection Model Refactor**: Switch from Dial-Back to Collector-Initiated Control Stream (Problem 2).
- **Database Schema**: Make table creation explicit instead of on-the-fly `ensure_table` (Problem 4).
- Wire up real SurrealDB metadata persistence in `SurrealIngestBackend` (parse chunk data and insert actual records).
- Implement `IT-100` (Blob Separation) and `IT-110` (OCR Transform).

## Blockers

- None.
