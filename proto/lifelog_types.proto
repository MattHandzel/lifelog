syntax = "proto3";
package lifelog;

import "google/protobuf/timestamp.proto";
import "google/protobuf/any.proto";
import "google/protobuf/wrappers.proto";

message UUID {
  string uuid = 1;
}

message Timerange {
  google.protobuf.Timestamp start = 1;
  google.protobuf.Timestamp end = 2;
}

// Canonical time quality classification used for timeline ordering and correlation.
// This mirrors `lifelog_core::time_skew::TimeQuality`.
enum TimeQuality {
  Unknown = 0;
  Good = 1;
  Degraded = 2;
}

message StreamIdentity {
  string collector_id = 1;
  string stream_id = 2;
  uint64 session_id = 3;
}

message ActorConfig {
}

message AmbientConfig {
  bool enabled = 1;
  double interval = 2;
  string output_dir = 3;
  google.protobuf.StringValue temperature_sensor_path = 4;
  google.protobuf.StringValue humidity_sensor_path = 5;
}

message AudioConfig {
  bool enabled = 1;
  string output_dir = 2;
  uint32 sample_rate = 3;
  uint64 chunk_duration_secs = 4;
}

message BrowserFrame {
  string uuid = 1;
  google.protobuf.Timestamp timestamp = 2;
  string url = 3;
  string title = 4;
  uint32 visit_count = 5;
  // Time model (Spec §4.2). `timestamp` remains the legacy device timestamp.
  google.protobuf.Timestamp t_device = 6;
  google.protobuf.Timestamp t_ingest = 7;
  google.protobuf.Timestamp t_canonical = 8;
  google.protobuf.Timestamp t_end = 9;
  TimeQuality time_quality = 10;
}

message BrowserHistoryConfig {
  bool enabled = 1;
  string input_file = 2;
  string output_file = 3;
  string browser_type = 4;
}

enum BrowserHistoryType {
  Chrome = 0;
  Firefox = 1;
}

message CameraConfig {
  bool enabled = 1;
  double interval = 2;
  string output_dir = 3;
  string device = 4;
  uint32 resolution_x = 5;
  uint32 resolution_y = 6;
  uint32 fps = 7;
  string timestamp_format = 8;
}

message CollectorConfig {
  string id = 1;
  string host = 2;
  uint32 port = 3;
  string timestamp_format = 4;
  BrowserHistoryConfig browser = 5;
  ScreenConfig screen = 6;
  CameraConfig camera = 7;
  MicrophoneConfig microphone = 8;
  ProcessesConfig processes = 9;
  HyprlandConfig hyprland = 10;
  WeatherConfig weather = 11;
  WifiConfig wifi = 12;
}

message CollectorState {
  string name = 1;
  google.protobuf.Timestamp timestamp = 2;
  repeated string source_states = 3;
  repeated string source_buffer_sizes = 4;
  uint32 total_buffer_size = 5;
  google.protobuf.Timestamp last_seen = 6;
  uint64 upload_lag_bytes = 7;
  google.protobuf.Timestamp last_upload_time = 8;
}

enum DataModality {
  Browser = 0;
  Ocr = 1;
  Screen = 2;
  Audio = 3;
  Keystrokes = 4;
  Clipboard = 5;
  ShellHistory = 6;
  WindowActivity = 7;
  Mouse = 8;
  Processes = 9;
  Camera = 10;
  Weather = 11;
  Hyprland = 12;
}

message GeoConfig {
  bool enabled = 1;
  double interval = 2;
  string output_dir = 3;
  bool use_ip_fallback = 4;
}

message HyprlandConfig {
  bool enabled = 1;
  double interval = 2;
  string output_dir = 3;
  bool log_clients = 4;
  bool log_activewindow = 5;
  bool log_workspace = 6;
  bool log_active_monitor = 7;
  bool log_devices = 8;
}

message HyprMonitor {
  int32 id = 1;
  string name = 2;
  string description = 3;
  int32 width = 4;
  int32 height = 5;
  float refresh_rate = 6;
  int32 x = 7;
  int32 y = 8;
  int32 workspace_id = 9;
  string workspace_name = 10;
  float scale = 11;
  bool focused = 12;
}

message HyprWorkspace {
  int32 id = 1;
  string name = 2;
  string monitor = 3;
  int32 monitor_id = 4;
  int32 windows = 5;
  bool fullscreen = 6;
  string last_window = 7;
  string last_window_title = 8;
}

message HyprClient {
  string address = 1;
  int32 x = 2;
  int32 y = 3;
  int32 width = 4;
  int32 height = 5;
  int32 workspace_id = 6;
  string workspace_name = 7;
  bool floating = 8;
  string fullscreen = 9;
  int32 monitor = 10;
  string title = 11;
  string class = 12;
  int32 pid = 13;
  bool pinned = 14;
  bool mapped = 15;
}

message HyprDevice {
  string type = 1;
  string name = 2;
  string address = 3;
}

message HyprCursor {
  double x = 1;
  double y = 2;
}

message HyprlandFrame {
  string uuid = 1;
  google.protobuf.Timestamp timestamp = 2;
  repeated HyprMonitor monitors = 3;
  repeated HyprWorkspace workspaces = 4;
  HyprWorkspace active_workspace = 5;
  repeated HyprClient clients = 6;
  repeated HyprDevice devices = 7;
  HyprCursor cursor = 8;
  google.protobuf.Timestamp t_device = 9;
  google.protobuf.Timestamp t_ingest = 10;
  google.protobuf.Timestamp t_canonical = 11;
  google.protobuf.Timestamp t_end = 12;
  TimeQuality time_quality = 13;
}

message InputLoggerConfig {
  string output_dir = 1;
  bool enabled = 2;
  bool log_keyboard = 3;
  bool log_mouse_buttons = 4;
  bool log_mouse_movement = 5;
  bool log_mouse_wheel = 6;
  bool log_devices = 7;
  double mouse_interval = 8;
}

message InterfaceState {
}

message KeyboardConfig {
  bool enabled = 1;
  double interval = 2;
  string output_dir = 3;
}

message MicrophoneConfig {
  bool enabled = 1;
  string output_dir = 2;
  uint32 sample_rate = 3;
  uint64 chunk_duration_secs = 4;
  string timestamp_format = 5;
  uint32 bits_per_sample = 6;
  uint32 channels = 7;
  uint64 capture_interval_secs = 8;
}

message MouseConfig {
  bool enabled = 1;
  double interval = 2;
  string output_dir = 3;
}

message NetworkConfig {
  bool enabled = 1;
  double interval = 2;
  string output_dir = 3;
}

message OcrFrame {
  string uuid = 1;
  google.protobuf.Timestamp timestamp = 2;
  string text = 3;
  google.protobuf.Timestamp t_device = 4;
  google.protobuf.Timestamp t_ingest = 5;
  google.protobuf.Timestamp t_canonical = 6;
  google.protobuf.Timestamp t_end = 7;
  TimeQuality time_quality = 8;
}

message ProcessesConfig {
  bool enabled = 1;
  double interval = 2;
  string output_dir = 3;
}

message ProcessInfo {
  int32 pid = 1;
  int32 ppid = 2;
  string name = 3;
  string exe = 4;
  string cmdline = 5;
  string status = 6;
  double cpu_usage = 7;
  int64 memory_usage = 8;
  int32 threads = 9;
  string user = 10;
  double start_time = 11;
}

message ProcessFrame {
  string uuid = 1;
  google.protobuf.Timestamp timestamp = 2;
  repeated ProcessInfo processes = 3;
  google.protobuf.Timestamp t_device = 4;
  google.protobuf.Timestamp t_ingest = 5;
  google.protobuf.Timestamp t_canonical = 6;
  google.protobuf.Timestamp t_end = 7;
  TimeQuality time_quality = 8;
}

message ScreenConfig {
  bool enabled = 1;
  double interval = 2;
  string output_dir = 3;
  string program = 4;
  string timestamp_format = 5;
}

message ScreenFrame {
  string uuid = 1;
  google.protobuf.Timestamp timestamp = 2;
  uint32 width = 3;
  uint32 height = 4;
  bytes image_bytes = 5;
  string mime_type = 6;
  google.protobuf.Timestamp t_device = 7;
  google.protobuf.Timestamp t_ingest = 8;
  google.protobuf.Timestamp t_canonical = 9;
  google.protobuf.Timestamp t_end = 10;
  TimeQuality time_quality = 11;
}

message CameraFrame {
  string uuid = 1;
  google.protobuf.Timestamp timestamp = 2;
  uint32 width = 3;
  uint32 height = 4;
  bytes image_bytes = 5;
  string mime_type = 6;
  string device = 7;
  google.protobuf.Timestamp t_device = 8;
  google.protobuf.Timestamp t_ingest = 9;
  google.protobuf.Timestamp t_canonical = 10;
  google.protobuf.Timestamp t_end = 11;
  TimeQuality time_quality = 12;
}

message WeatherFrame {
  string uuid = 1;
  google.protobuf.Timestamp timestamp = 2;
  double temperature = 3;
  double humidity = 4;
  double pressure = 5;
  string conditions = 6;
  google.protobuf.Timestamp t_device = 7;
  google.protobuf.Timestamp t_ingest = 8;
  google.protobuf.Timestamp t_canonical = 9;
  google.protobuf.Timestamp t_end = 10;
  TimeQuality time_quality = 11;
}

message AudioFrame {
  string uuid = 1;
  google.protobuf.Timestamp timestamp = 2;
  bytes audio_bytes = 3;
  string codec = 4;
  uint32 sample_rate = 5;
  uint32 channels = 6;
  float duration_secs = 7;
  google.protobuf.Timestamp t_device = 8;
  google.protobuf.Timestamp t_ingest = 9;
  google.protobuf.Timestamp t_canonical = 10;
  google.protobuf.Timestamp t_end = 11;
  TimeQuality time_quality = 12;
}

message KeystrokeFrame {
  string uuid = 1;
  google.protobuf.Timestamp timestamp = 2;
  string text = 3;
  string application = 4;
  string window_title = 5;
  google.protobuf.Timestamp t_device = 6;
  google.protobuf.Timestamp t_ingest = 7;
  google.protobuf.Timestamp t_canonical = 8;
  google.protobuf.Timestamp t_end = 9;
  TimeQuality time_quality = 10;
}

message ClipboardFrame {
  string uuid = 1;
  google.protobuf.Timestamp timestamp = 2;
  string text = 3;
  bytes binary_data = 4;
  string mime_type = 5;
  google.protobuf.Timestamp t_device = 6;
  google.protobuf.Timestamp t_ingest = 7;
  google.protobuf.Timestamp t_canonical = 8;
  google.protobuf.Timestamp t_end = 9;
  TimeQuality time_quality = 10;
}

message ShellHistoryFrame {
  string uuid = 1;
  google.protobuf.Timestamp timestamp = 2;
  string command = 3;
  string working_dir = 4;
  int32 exit_code = 5;
  google.protobuf.Timestamp t_device = 6;
  google.protobuf.Timestamp t_ingest = 7;
  google.protobuf.Timestamp t_canonical = 8;
  google.protobuf.Timestamp t_end = 9;
  TimeQuality time_quality = 10;
}

message WindowActivityFrame {
  string uuid = 1;
  google.protobuf.Timestamp timestamp = 2;
  string application = 3;
  string window_title = 4;
  bool focused = 5;
  float duration_secs = 6;
  google.protobuf.Timestamp t_device = 7;
  google.protobuf.Timestamp t_ingest = 8;
  google.protobuf.Timestamp t_canonical = 9;
  google.protobuf.Timestamp t_end = 10;
  TimeQuality time_quality = 11;
}

message MouseFrame {
  string uuid = 1;
  google.protobuf.Timestamp timestamp = 2;
  double x = 3;
  double y = 4;
  enum MouseButton {
    None = 0;
    Left = 1;
    Right = 2;
    Middle = 3;
  }
  MouseButton button = 5;
  bool pressed = 6;
  google.protobuf.Timestamp t_device = 7;
  google.protobuf.Timestamp t_ingest = 8;
  google.protobuf.Timestamp t_canonical = 9;
  google.protobuf.Timestamp t_end = 10;
  TimeQuality time_quality = 11;
}

enum ServerActionType {
  Querying = 0;
  GetData = 1;
  SyncData = 2;
  TransformData = 3;
  CompressData = 4;
  RegisterActor = 5;
}

message ServerConfig {
  string host = 1;
  uint32 port = 2;
  string database_endpoint = 3;
  string database_name = 4;
  string server_name = 5;
  string cas_path = 6;
  // Spec §4.3: global default correlation window (Δt_default) used when query predicates omit
  // an explicit temporal window.
  uint64 default_correlation_window_ms = 7;
}

message ServerState {
  string name = 1;
  google.protobuf.Timestamp timestamp = 2;
  float cpu_usage = 3;
  float memory_usage = 4;
  float threads = 5;
  google.protobuf.Timestamp timestamp_of_last_sync = 6;
  repeated ServerActionType pending_actions = 7;
  string version = 8;
  uint64 total_frames_stored = 9;
  uint64 disk_usage_bytes = 10;
  google.protobuf.Timestamp uptime_since = 11;
}

message SystemConfig {
  ServerConfig server = 1;
  map<string,CollectorConfig> collectors = 2;
}

message SystemPerformanceConfig {
  bool enabled = 1;
  double interval = 2;
  string output_dir = 3;
  bool log_cpu = 4;
  bool log_memory = 5;
  bool log_disk = 6;
}

message SystemState {
  map<string,CollectorState> collector_states = 1;
  map<string,InterfaceState> interface_states = 2;
  ServerState server_state = 3;
}

message TextUploadConfig {
  bool enabled = 1;
  string output_dir = 2;
  uint32 max_file_size_mb = 3;
  repeated string supported_formats = 4;
}

message WeatherConfig {
  bool enabled = 1;
  double interval = 2;
  string output_dir = 3;
  string api_key = 4;
  double latitude = 5;
  double longitude = 6;
}

message WifiConfig {
  bool enabled = 1;
  double interval = 2;
  string output_dir = 3;
  string scan_command = 4;
}

message LifelogData {
  oneof payload {
    BrowserFrame browserframe = 1;
    OcrFrame ocrframe = 2;
    ScreenFrame screenframe = 3;
    AudioFrame audioframe = 4;
    KeystrokeFrame keystrokeframe = 5;
    ClipboardFrame clipboardframe = 6;
    ShellHistoryFrame shellhistoryframe = 7;
    WindowActivityFrame windowactivityframe = 8;
    MouseFrame mouseframe = 9;
    ProcessFrame processframe = 10;
    CameraFrame cameraframe = 11;
    WeatherFrame weatherframe = 12;
    HyprlandFrame hyprlandframe = 13;
  }
}
